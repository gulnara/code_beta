<div id="container" class="container">  
  <nav id="bt-menu" class="bt-menu">
    <a href="#" class="bt-menu-trigger"><span>Menu</span></a>
    <%= render "layouts/header" %>
  </nav>
  <div class="menu-panel">
    <ul id="menu-toc" class="menu-toc">
    <h2><span>Problems</span></h2>
    <%= link_to 'CREAT A NEW PROBLEM', new_problem_path %>
    <table>
        <thead>
          <tr>
          <th>Title</th>
          </tr>
        </thead>
        <tbody>
      <%@problem.each do |problem|%>
      <tr>
        <%if problem.user_id == @user.id %>
          <td><%= link_to problem.title, problem %></td>

        <% end %>
      <%end%>
      </tr>
      </tbody>
      </table>
    </ul>
  </div>
  <div class="side-panel">
    <ul id="side-toc" class="side-toc">
    <h2>Solutions</h2>
      <table>
        <thead>
          <tr>
          <th>Solution To</th>
          <th>In</th>

          </tr>
        </thead>
        <tbody>
          <%@user.solutions.each do |solution|%>
            <tr>
            <% p_id = solution.problem_id %>
            <%problem = @user.problems.find{|a| a.id == p_id}%>
            <td><%= link_to problem.title, problem_solution_path(:problem_id => solution.problem_id, :id => solution.id) %></td>
            <td><%=  solution.language %>
          </tr>
          <%end%>
        </tbody>
      </table>
    </ul>
  </div>
  <div class="bb-custom-wrapper">
    <div id="bb-bookblock" class="bb-bookblock">
      <div class="bb-item" id="item1">
        <div class="content">
          <div class="scroller">
            <div class= "profile">
            <%= image_tag @user.avatar.url(:thumb) %>
            </div>
            <h1><%= @user.name %></h1>
            <p><%= @user.language %></p>
            <p><%= link_to "@#{@user.twitter}", "https://twitter.com/#{@user.twitter}" %></p>
            <p><%= link_to "#{@user.github}", @user.github %></p>
            <% url = @user.url %>
            <p><%= link_to "#{@user.url}" , url %></p>

            <div class="analytics">

            <style>

            #chart1 svg {
              height: 400px;
            }

            </style>

            <div id="chart1">
              <svg></svg>
            </div>
         <style>

            #chart2 svg {
              height: 400px;
            }

            </style>

            <div id="chart2">
              <svg></svg>
            </div>

                     <style>

            #chart3 svg {
              height: 400px;
            }

            </style>

            <div id="chart3">
              <svg></svg>
            </div>

            <%languages = @user.solutions.map{|a| a.language}%>
            <%counts = Hash.new(0)%>
            <%languages.each { |name| counts[name] += 1 }%>
            <% @d_3 = []%>
            <% counts.each do |key, value| %>
              <% @d_3 << {"label" => key, "value"=> value.to_s}%>
             

              
            <%end %> 
            <% @new_data = @d_3%>
          </div>

          </div>
        </div>
      </div>
    </div>
    <span id="tblcontents" class="menu-button">
      <%= image_tag('flask.png', :size=>'50x50') %>
    </span>
    <span id="sidecontents" class="side-button">
      <%= image_tag('bulb.png', :size=>'50x50') %>
    </span>
  </div>
</div><!-- /container -->

<script>

              //Regular pie chart example
nv.addGraph(function() {
  var chart1 = nv.models.pieChart()
      .x(function(d) { return d.label })
      .y(function(d) { return d.value })
      .showLabels(true);

    d3.select("#chart1 svg")
        .datum(data1)
      .transition().duration(1200)
        .call(chart1);

  return chart1;
});

nv.addGraph(function() {
  var chart2 = nv.models.pieChart()
      .x(function(d) { return d.label })
      .y(function(d) { return d.value })
      .showLabels(true);

    d3.select("#chart2 svg")
        .datum(data2)
      .transition().duration(1200)
        .call(chart2);

  return chart2;
});

nv.addGraph(function() {
  var chart3 = nv.models.pieChart()
      .x(function(d) { return d.label })
      .y(function(d) { return d.value })
      .showLabels(true);

    d3.select("#chart3 svg")
        .datum(data3)
      .transition().duration(1200)
        .call(chart3);

  return chart3;
});

var t_p_l = "Total Problems " + <%= @problem.count.to_json %>;
var t_y_p_l = "Your Problems " + <%= @user.created_problems.count.to_json %>;
var t_s_l = "Total Solutions " + <%= @solutions.count.to_json %>;
var t_y_s_l = "Your Solutions " + <%= @user.solutions.count.to_json %>;
var t_problem = <%= @problem.count.to_json %>;
var y_problem = <%= @user.created_problems.count.to_json %>;
var t_solution = <%= @solutions.count.to_json %>;
var y_solution = <%= @user.solutions.count.to_json %>;
//Pie chart example data. Note how there is only a single array of key-value pairs.
 var data1 = [
      {
        "label": t_p_l,
        "value" : t_problem
      } ,
      {
        "label": t_y_p_l,
        "value" : y_problem
      } 
]

 var data2 = [
      {
        "label": t_s_l,
        "value" : t_solution
      } ,
      {
        "label": t_y_s_l,
        "value" : y_solution
      } 
]
// var new_data = <%= @d_3.to_json %>;
var data3 = <%=@new_data.to_json%>;








</script>
